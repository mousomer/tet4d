{
  "schema_version": 1,
  "title": "tet4d canonical maintenance contract",
  "description": "Machine-checked source-of-truth rules for docs/tests/help/backlog/RDS/feature-map consistency.",
  "required_paths": {
    "root_docs": [
      "README.md",
      "docs/README.md",
      "docs/PROJECT_STRUCTURE.md",
      "docs/FEATURE_MAP.md",
      "docs/BACKLOG.md",
      "docs/CHANGELOG.md",
      "docs/RDS_AND_CODEX.md",
      "docs/SECURITY_AND_CONFIG_PLAN.md"
    ],
    "rds_docs": [
      "docs/rds/RDS_TETRIS_GENERAL.md",
      "docs/rds/RDS_2D_TETRIS.md",
      "docs/rds/RDS_3D_TETRIS.md",
      "docs/rds/RDS_4D_TETRIS.md",
      "docs/rds/RDS_KEYBINDINGS.md",
      "docs/rds/RDS_MENU_STRUCTURE.md",
      "docs/rds/RDS_PLAYBOT.md",
      "docs/rds/RDS_SCORE_ANALYZER.md",
      "docs/rds/RDS_PACKAGING.md"
    ],
    "help_assets": [
      "tetris_nd/menu_control_guides.py",
      "tetris_nd/control_icons.py",
      "assets/help/icons/transform/svg/16/dark/move_x_pos.svg"
    ],
    "canonical_schemas": [
      "config/schema/menu_settings.schema.json",
      "config/schema/save_state.schema.json",
      "config/schema/help_topics.schema.json",
      "config/schema/help_action_map.schema.json"
    ],
    "migration_ledgers": [
      "docs/migrations/menu_settings.md",
      "docs/migrations/save_state.md"
    ],
    "replay_contract": [
      "tests/replay/manifest.json",
      "tests/replay/golden/.gitkeep"
    ],
    "help_contract": [
      "docs/help/HELP_INDEX.md",
      "assets/help/manifest.json"
    ],
    "release_contract": [
      "docs/RELEASE_CHECKLIST.md",
      "docs/RELEASE_INSTALLERS.md"
    ],
    "core_tests": [
      "tetris_nd/tests/test_playbot.py",
      "tetris_nd/tests/test_score_analyzer.py",
      "tetris_nd/tests/test_runtime_config.py",
      "tetris_nd/tests/test_menu_policy.py",
      "tetris_nd/tests/test_project_config.py",
      "tetris_nd/tests/test_help_topics.py",
      "tetris_nd/tests/test_help_menu.py"
    ],
    "canonical_configs": [
      "config/menu/defaults.json",
      "config/menu/structure.json",
      "config/topology/designer_presets.json",
      "config/help/topics.json",
      "config/help/action_map.json",
      "config/help/icon_map.json",
      "config/gameplay/tuning.json",
      "config/gameplay/score_analyzer.json",
      "config/playbot/policy.json",
      "config/audio/sfx.json",
      "config/project/io_paths.json",
      "config/project/constants.json",
      "config/project/secret_scan.json",
      "config/project/canonical_maintenance.json"
    ],
    "ci_scripts": [
      "scripts/bootstrap_env.sh",
      "scripts/ci_check.sh",
      "scripts/verify.sh",
      "scripts/check_git_sanitation.sh",
      "scripts/check_policy_compliance.sh",
      "tools/check_pygame_ce.py",
      "tools/scan_secrets.py",
      "tools/lint_menu_graph.py",
      "tools/validate_project_contracts.py",
      ".github/workflows/ci.yml",
      ".github/workflows/stability-watch.yml",
      ".github/workflows/release-packaging.yml"
    ],
    "governance": [
      "AGENTS.md",
      ".workspace_policy_version.json",
      "config/project/policy_manifest.json"
    ],
    "packaging_scripts": [
      "packaging/pyinstaller/tet4d.spec",
      "packaging/scripts/build_macos.sh",
      "packaging/scripts/build_linux.sh",
      "packaging/scripts/build_windows.ps1"
    ]
  },
  "content_rules": [
    {
      "file": "README.md",
      "must_contain": [
        "Documentation map",
        "scripts/bootstrap_env.sh",
        "config/gameplay/score_analyzer.json",
        "menu_control_guides.py",
        "draw_translation_rotation_guides",
        "scripts/ci_check.sh",
        "tools/check_pygame_ce.py",
        "tools/scan_secrets.py",
        "config/project/io_paths.json",
        "config/project/constants.json",
        "config/project/secret_scan.json",
        "docs/RELEASE_INSTALLERS.md",
        "packaging/scripts/build_macos.sh"
      ]
    },
    {
      "file": "docs/FEATURE_MAP.md",
      "must_contain": [
        "## 4. Keybindings",
        "## 6. Scoring and Assistance",
        "## 9. Verification Coverage"
      ]
    },
    {
      "file": "docs/BACKLOG.md",
      "must_contain": [
        "## 3. Active Open Backlog / TODO",
        "## 5. Change Footprint",
        "[BKL-P3-001]",
        "Cadence:",
        "Trigger:",
        "Done criteria:"
      ],
      "must_not_contain": [
        "No currently open gaps",
        "126 passed"
      ],
      "must_match_regex": [
        "\\[BKL-P3-\\d{3}\\]"
      ],
      "must_not_match_regex": [
        "\\b\\d+\\s+passed\\b",
        "\\[[\\s\\d%]+\\]"
      ]
    },
    {
      "file": "docs/GUIDELINES_RESEARCH.md",
      "must_contain": [
        "## 3. Current issues (open backlog)",
        "docs/BACKLOG.md"
      ],
      "must_not_contain": [
        "No active open gaps",
        "126 passed"
      ],
      "must_not_match_regex": [
        "\\b\\d+\\s+passed\\b",
        "\\[[\\s\\d%]+\\]"
      ]
    },
    {
      "file": "docs/RDS_AND_CODEX.md",
      "must_contain": [
        "RDS index",
        "Testing instructions",
        "docs/BACKLOG.md",
        "docs/rds/RDS_PACKAGING.md"
      ],
      "must_not_match_regex": [
        "\\b\\d+\\s+passed\\b",
        "\\[[\\s\\d%]+\\]"
      ]
    },
    {
      "file": "scripts/ci_check.sh",
      "must_contain": [
        "require_module ruff ruff",
        "require_module pytest pytest",
        "run_module ruff check .",
        "run_module ruff check --select C901 .",
        "tools/lint_menu_graph.py",
        "tools/scan_secrets.py",
        "run_module pytest -q"
      ],
      "must_not_contain": [
        "run_module_or_command"
      ]
    },
    {
      "file": "AGENTS.md",
      "must_contain": [
        "docs/RDS_AND_CODEX.md",
        "config/project/canonical_maintenance.json",
        "tools/validate_project_contracts.py",
        "./scripts/verify.sh",
        "config/project/io_paths.json"
      ]
    },
    {
      "file": "scripts/verify.sh",
      "must_contain": [
        "#!/usr/bin/env bash",
        "set -euo pipefail",
        "exec ./scripts/ci_check.sh"
      ]
    },
    {
      "file": "scripts/check_policy_compliance.sh",
      "must_contain": [
        ".workspace_policy_version.json",
        "config/project/policy_manifest.json",
        "python3 tools/validate_project_contracts.py",
        "python3 tools/scan_secrets.py"
      ]
    },
    {
      "file": "scripts/check_git_sanitation.sh",
      "must_contain": [
        "#!/usr/bin/env bash",
        "set -euo pipefail",
        "Absolute filesystem paths detected.",
        "Potential unsafe path traversal patterns detected."
      ]
    },
    {
      "file": "config/project/policy_manifest.json",
      "must_contain": [
        "\"project_name\": \"tet4d\"",
        "\"verification_command\": \"./scripts/verify.sh\"",
        "\"ci_entrypoint\": \"./scripts/ci_check.sh\"",
        "\"contract_validation\": \"python3 tools/validate_project_contracts.py\"",
        "\"secret_scan\": \"python3 tools/scan_secrets.py\""
      ]
    },
    {
      "file": ".github/workflows/ci.yml",
      "must_contain": [
        "SDL_VIDEODRIVER: dummy",
        "SDL_AUDIODRIVER: dummy",
        "scripts/check_git_sanitation.sh",
        "scripts/check_policy_compliance.sh",
        "./scripts/ci_check.sh"
      ]
    },
    {
      "file": "docs/SECURITY_AND_CONFIG_PLAN.md",
      "must_contain": [
        "## 2. Secret scanning policy",
        "config/project/secret_scan.json",
        "tools/scan_secrets.py",
        "## 3. Path/config externalization policy",
        "config/project/io_paths.json",
        "config/project/constants.json"
      ]
    },
    {
      "file": "docs/rds/RDS_TETRIS_GENERAL.md",
      "must_contain": [
        "Target Runtime: Python 3.11-3.14 + `pygame-ce`",
        "## 8. Testing Instructions",
        "## 10. Backlog Status"
      ]
    },
    {
      "file": "docs/RELEASE_INSTALLERS.md",
      "must_contain": [
        "PyInstaller",
        "packaging/scripts/build_macos.sh",
        "packaging/scripts/build_linux.sh",
        "packaging/scripts/build_windows.ps1",
        ".github/workflows/release-packaging.yml"
      ]
    },
    {
      "file": "docs/rds/RDS_PACKAGING.md",
      "must_contain": [
        "Desktop Packaging RDS",
        "packaging/pyinstaller/tet4d.spec",
        ".github/workflows/release-packaging.yml"
      ]
    },
    {
      "file": "config/project/io_paths.json",
      "must_contain": [
        "\"paths\"",
        "\"menu_settings_file\"",
        "\"keybindings_dir\""
      ]
    },
    {
      "file": "config/project/constants.json",
      "must_contain": [
        "\"cache_limits\"",
        "\"animation\"",
        "\"rendering\""
      ]
    },
    {
      "file": "config/project/secret_scan.json",
      "must_contain": [
        "\"patterns\"",
        "\"exclude_dirs\""
      ]
    },
    {
      "file": "config/schema/menu_settings.schema.json",
      "must_contain": [
        "\"$schema\"",
        "\"title\": \"tet4d menu settings\"",
        "\"settings\""
      ]
    },
    {
      "file": "config/schema/save_state.schema.json",
      "must_contain": [
        "\"$schema\"",
        "\"title\": \"tet4d saved game state\"",
        "\"active_piece\""
      ]
    },
    {
      "file": "config/schema/help_topics.schema.json",
      "must_contain": [
        "\"$schema\"",
        "\"title\": \"tet4d help topics registry\"",
        "\"topics\""
      ]
    },
    {
      "file": "config/schema/help_action_map.schema.json",
      "must_contain": [
        "\"$schema\"",
        "\"title\": \"tet4d help action topic map\"",
        "\"action_topics\""
      ]
    },
    {
      "file": "config/help/topics.json",
      "must_contain": [
        "\"version\"",
        "\"topics\"",
        "\"id\"",
        "\"lane\"",
        "\"sections\""
      ]
    },
    {
      "file": "config/help/action_map.json",
      "must_contain": [
        "\"version\"",
        "\"default_topic\"",
        "\"action_topics\"",
        "\"move_x_neg\""
      ]
    },
    {
      "file": "config/help/icon_map.json",
      "must_contain": [
        "\"version\"",
        "\"pack_root\"",
        "\"action_map\"",
        "\"rotate_xy_pos\"",
        "\"rot_xy_pos\""
      ]
    },
    {
      "file": "docs/migrations/menu_settings.md",
      "must_contain": [
        "## Version 1",
        "## Migration policy"
      ]
    },
    {
      "file": "docs/migrations/save_state.md",
      "must_contain": [
        "## Version 1 (planned)",
        "## Migration policy"
      ]
    },
    {
      "file": "tests/replay/manifest.json",
      "must_contain": [
        "\"version\": 1",
        "\"gameplay_replay_core\""
      ]
    },
    {
      "file": "docs/help/HELP_INDEX.md",
      "must_contain": [
        "## Control diagrams",
        "## Maintenance rule"
      ]
    },
    {
      "file": "assets/help/manifest.json",
      "must_contain": [
        "\"translation_keys\"",
        "\"rotation_keys\""
      ]
    },
    {
      "file": "docs/RELEASE_CHECKLIST.md",
      "must_contain": [
        "## Code and tests",
        "## Documentation and RDS sync",
        "## Artifacts and config"
      ]
    }
  ],
  "canonical_candidates": [
    {
      "name": "Settings schema and migration ledger",
      "paths": [
        "config/schema/menu_settings.schema.json",
        "docs/migrations/menu_settings.md"
      ],
      "status": "connected"
    },
    {
      "name": "Saved-game/state schema",
      "paths": [
        "config/schema/save_state.schema.json",
        "docs/migrations/save_state.md"
      ],
      "status": "connected"
    },
    {
      "name": "Replay golden fixtures manifest",
      "paths": [
        "tests/replay/manifest.json",
        "tests/replay/golden/.gitkeep"
      ],
      "status": "connected"
    },
    {
      "name": "Help content index",
      "paths": [
        "docs/help/HELP_INDEX.md",
        "assets/help/manifest.json"
      ],
      "status": "connected"
    },
    {
      "name": "Help topic contract and schemas",
      "paths": [
        "config/help/topics.json",
        "config/help/action_map.json",
        "config/schema/help_topics.schema.json",
        "config/schema/help_action_map.schema.json"
      ],
      "status": "connected"
    },
    {
      "name": "Release checklist",
      "paths": [
        "docs/RELEASE_CHECKLIST.md"
      ],
      "status": "connected"
    },
    {
      "name": "Security and config policy",
      "paths": [
        "docs/SECURITY_AND_CONFIG_PLAN.md",
        "config/project/io_paths.json",
        "config/project/constants.json",
        "config/project/secret_scan.json",
        "tools/scan_secrets.py"
      ],
      "status": "connected"
    }
  ]
}
