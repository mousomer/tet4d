{
  "schema_version": 1,
  "title": "tet4d canonical maintenance contract",
  "description": "Machine-checked source-of-truth rules for docs/tests/help/backlog/RDS/feature-map consistency.",
  "required_paths": {
    "root_docs": [
      "README.md",
      "docs/README.md",
      "docs/PROJECT_STRUCTURE.md",
      "docs/FEATURE_MAP.md",
      "docs/BACKLOG.md",
      "docs/CHANGELOG.md",
      "docs/RDS_AND_CODEX.md",
      "docs/SECURITY_AND_CONFIG_PLAN.md"
    ],
    "rds_docs": [
      "docs/rds/RDS_TETRIS_GENERAL.md",
      "docs/rds/RDS_2D_TETRIS.md",
      "docs/rds/RDS_3D_TETRIS.md",
      "docs/rds/RDS_4D_TETRIS.md",
      "docs/rds/RDS_KEYBINDINGS.md",
      "docs/rds/RDS_MENU_STRUCTURE.md",
      "docs/rds/RDS_PLAYBOT.md",
      "docs/rds/RDS_SCORE_ANALYZER.md",
      "docs/rds/RDS_PACKAGING.md"
    ],
    "help_assets": [
      "src/tet4d/ui/pygame/menu/menu_control_guides.py",
      "src/tet4d/ui/pygame/render/control_icons.py",
      "assets/help/icons/transform/svg/16/dark/move_x_pos.svg"
    ],
    "canonical_schemas": [
      "config/schema/menu_settings.schema.json",
      "config/schema/save_state.schema.json",
      "config/schema/help_topics.schema.json",
      "config/schema/help_action_map.schema.json",
      "config/schema/help_runtime_content.schema.json",
      "config/schema/help_runtime_layout.schema.json"
    ],
    "migration_ledgers": [
      "docs/migrations/menu_settings.md",
      "docs/migrations/save_state.md"
    ],
    "replay_contract": [
      "config/project/policy/manifests/replay_manifest.json",
      "tests/replay/golden/.gitkeep"
    ],
    "help_contract": [
      "docs/help/HELP_INDEX.md",
      "config/project/policy/manifests/help_assets_manifest.json"
    ],
    "release_contract": [
      "docs/RELEASE_CHECKLIST.md",
      "docs/RELEASE_INSTALLERS.md"
    ],
    "core_tests": [
      "tests/unit/engine/test_playbot.py",
      "tests/unit/engine/test_score_analyzer.py",
      "tests/unit/engine/test_runtime_config.py",
      "tests/unit/engine/test_menu_policy.py",
      "tests/unit/engine/test_project_config.py",
      "tests/unit/engine/test_help_topics.py",
      "tests/unit/engine/test_help_menu.py",
      "tests/unit/engine/test_help_text.py"
    ],
    "canonical_configs": [
      "config/menu/defaults.json",
      "config/menu/structure.json",
      "config/topology/designer_presets.json",
      "config/help/topics.json",
      "config/help/action_map.json",
      "config/help/icon_map.json",
      "config/help/content/runtime_help_content.json",
      "config/help/layout/runtime_help_layout.json",
      "config/help/layout/runtime_help_action_layout.json",
      "config/gameplay/tuning.json",
      "config/gameplay/piece_sets_nd.json",
      "config/gameplay/score_analyzer.json",
      "config/playbot/policy.json",
      "config/audio/sfx.json",
      "config/project/io_paths.json",
      "config/project/constants.json",
      "config/project/folder_balance_budgets.json",
      "config/project/policy/manifests/tech_debt_budgets.json",
      "config/project/backlog_debt.json",
      "config/project/policy/manifests/secret_scan.json",
      "config/project/policy/manifests/canonical_maintenance.json",
      "config/project/policy/manifests/architecture_metrics.json"
    ],
    "ci_scripts": [
      "scripts/bootstrap_env.sh",
      "scripts/install_git_hooks.sh",
      "scripts/ci_check.sh",
      "scripts/verify.sh",
      "scripts/check_git_sanitation.sh",
      "scripts/check_policy_compliance.sh",
      "tools/governance/check_pygame_ce.py",
      "tools/governance/scan_secrets.py",
      "tools/governance/lint_menu_graph.py",
      "tools/governance/architecture_metric_budget.py",
      "tools/governance/tech_debt_budget.py",
      "tools/governance/update_tech_debt_budgets.py",
      "tools/governance/validate_project_contracts.py",
      ".github/workflows/ci.yml",
      ".github/workflows/stability-watch.yml",
      ".github/workflows/release-packaging.yml",
      "scripts/check_policy_template_drift.sh",
      "scripts/update_policy_template_hashes.sh",
      "scripts/check_git_sanitation_repo.sh",
      "scripts/check_policy_compliance_repo.sh",
      "scripts/check_architecture_metrics_soft_gate.sh"
    ],
    "governance": [
      "AGENTS.md",
      "CONTRIBUTING.md",
      "docs/policies/POLICY_NO_REINVENTING_WHEEL.md",
      "docs/policies/POLICY_STRING_SANITATION.md",
      "docs/policies/POLICY_NO_MAGIC_NUMBERS.md",
      "docs/policies/POLICY_FORMATTING.md",
      "config/project/policy/pack.json",
      "config/project/policy/manifests/project_policy.json",
      "config/project/policy/manifests/context_router_manifest.json",
      ".githooks/pre-push"
    ],
    "packaging_scripts": [
      "packaging/pyinstaller/tet4d.spec",
      "packaging/scripts/build_macos.sh",
      "packaging/scripts/build_linux.sh",
      "packaging/scripts/build_windows.ps1"
    ]
  },
  "content_rules": [
    {
      "file": "README.md",
      "must_contain": [
        "Documentation map",
        "scripts/bootstrap_env.sh",
        "config/gameplay/score_analyzer.json",
        "menu_control_guides.py",
        "draw_translation_rotation_guides",
        "scripts/ci_check.sh",
        "tools/governance/check_pygame_ce.py",
        "tools/governance/scan_secrets.py",
        "config/project/io_paths.json",
        "config/project/constants.json",
        "config/project/policy/manifests/secret_scan.json",
        "docs/RELEASE_INSTALLERS.md",
        "packaging/scripts/build_macos.sh"
      ]
    },
    {
      "file": "docs/FEATURE_MAP.md",
      "must_contain": [
        "## 4. Keybindings",
        "## 6. Scoring and Assistance",
        "## 9. Verification Coverage"
      ]
    },
    {
      "file": "docs/BACKLOG.md",
      "must_contain": [
        "## 3. Active Open Backlog / TODO",
        "## 5. Change Footprint",
        "[BKL-P3-001]",
        "Cadence:",
        "Trigger:",
        "Done criteria:"
      ],
      "must_not_contain": [
        "No currently open gaps",
        "126 passed"
      ],
      "must_match_regex": [
        "\\[BKL-P3-\\d{3}\\]"
      ],
      "must_not_match_regex": [
        "\\b\\d+\\s+passed\\b",
        "\\[[\\s\\d%]+\\]"
      ]
    },
    {
      "file": "docs/GUIDELINES_RESEARCH.md",
      "must_contain": [
        "## 3. Current issues (open backlog)",
        "docs/BACKLOG.md"
      ],
      "must_not_contain": [
        "No active open gaps",
        "126 passed"
      ],
      "must_not_match_regex": [
        "\\b\\d+\\s+passed\\b",
        "\\[[\\s\\d%]+\\]"
      ]
    },
    {
      "file": "docs/RDS_AND_CODEX.md",
      "must_contain": [
        "RDS index",
        "Testing instructions",
        "docs/BACKLOG.md",
        "docs/rds/RDS_PACKAGING.md"
      ],
      "must_not_match_regex": [
        "\\b\\d+\\s+passed\\b",
        "\\[[\\s\\d%]+\\]"
      ]
    },
    {
      "file": "scripts/ci_check.sh",
      "must_contain": [
        "#!/usr/bin/env bash",
        "set -euo pipefail",
        "QUIET=\"${QUIET:-1}\"",
        "CODEX_MODE=\"${CODEX_MODE:-0}\"",
        "exec ./scripts/verify.sh"
      ],
      "must_not_contain": [
        "run_module_or_command",
        "require_module ruff ruff"
      ]
    },
    {
      "file": "AGENTS.md",
      "must_contain": [
        "docs/RDS_AND_CODEX.md",
        "docs/policies/",
        "config/project/policy/manifests/canonical_maintenance.json",
        "tools/governance/validate_project_contracts.py",
        "./scripts/verify.sh",
        "config/project/io_paths.json"
      ]
    },
    {
      "file": "CONTRIBUTING.md",
      "must_contain": [
        "## Policies",
        "docs/policies/POLICY_NO_REINVENTING_WHEEL.md",
        "docs/policies/POLICY_STRING_SANITATION.md",
        "docs/policies/POLICY_NO_MAGIC_NUMBERS.md"
      ]
    },
    {
      "file": "scripts/verify.sh",
      "must_contain": [
        "#!/usr/bin/env bash",
        "set -euo pipefail",
        "CODEX_MODE=\"${CODEX_MODE:-0}\"",
        "run_step \"contracts\"",
        "echo \"verify: OK\"",
        "check_architecture_metrics_soft_gate.sh"
      ]
    },
    {
      "file": "scripts/install_git_hooks.sh",
      "must_contain": [
        "git config --local core.hooksPath .githooks",
        "chmod +x .githooks/pre-push"
      ]
    },
    {
      "file": ".githooks/pre-push",
      "must_contain": [
        "./scripts/ci_check.sh",
        "CODEX_MODE"
      ]
    },
    {
      "file": "config/project/policy/manifests/project_policy.json",
      "must_contain": [
        "\"project_name\": \"tet4d\"",
        "\"verification_command\": \"./scripts/verify.sh\"",
        "\"ci_entrypoint\": \"./scripts/ci_check.sh\"",
        "\"contract_validation\": \"python3 tools/governance/validate_project_contracts.py\"",
        "\"secret_scan\": \"python3 tools/governance/scan_secrets.py\"",
        "\"policy_id\": \"workspace-github-sanitation-and-security\"",
        "\"policy_source\": \"workspace/policy-kit\"",
        "\"enforcement\"",
        "\"scripts/check_policy_template_drift.sh\"",
        "\"extended_enforcement\"",
        "\"scripts/check_policy_compliance_repo.sh\"",
        "\"scripts/check_git_sanitation_repo.sh\""
      ],
      "must_match_regex": [
        "\\\"policy_version\\\"\\s*:\\s*\\\"1\\.1\\.\\d+\\\"",
        "\\\"policy_source_path\\\"\\s*:\\s*\\\"(\\$\\{HOME\\}/workspace/policy-kit|/[^\\\"\\n]+)\\\""
      ]
    },
    {
      "file": ".github/workflows/ci.yml",
      "must_contain": [
        "SDL_VIDEODRIVER: dummy",
        "SDL_AUDIODRIVER: dummy",
        "scripts/check_git_sanitation.sh",
        "scripts/check_policy_compliance.sh",
        "./scripts/ci_check.sh",
        "scripts/check_policy_template_drift.sh",
        "scripts/check_git_sanitation_repo.sh",
        "scripts/check_policy_compliance_repo.sh"
      ]
    },
    {
      "file": "docs/SECURITY_AND_CONFIG_PLAN.md",
      "must_contain": [
        "## 2. Secret scanning policy",
        "config/project/policy/manifests/secret_scan.json",
        "tools/governance/scan_secrets.py",
        "## 3. Path/config externalization policy",
        "config/project/io_paths.json",
        "config/project/constants.json"
      ]
    },
    {
      "file": "docs/rds/RDS_TETRIS_GENERAL.md",
      "must_contain": [
        "Target Runtime: Python 3.11-3.14 + `pygame-ce`",
        "## 8. Testing Instructions",
        "## 10. Backlog Status"
      ]
    },
    {
      "file": "docs/RELEASE_INSTALLERS.md",
      "must_contain": [
        "PyInstaller",
        "packaging/scripts/build_macos.sh",
        "packaging/scripts/build_linux.sh",
        "packaging/scripts/build_windows.ps1",
        ".github/workflows/release-packaging.yml"
      ]
    },
    {
      "file": "docs/rds/RDS_PACKAGING.md",
      "must_contain": [
        "Desktop Packaging RDS",
        "packaging/pyinstaller/tet4d.spec",
        ".github/workflows/release-packaging.yml"
      ]
    },
    {
      "file": "config/project/io_paths.json",
      "must_contain": [
        "\"paths\"",
        "\"menu_settings_file\"",
        "\"keybindings_dir\""
      ]
    },
    {
      "file": "config/project/constants.json",
      "must_contain": [
        "\"cache_limits\"",
        "\"animation\"",
        "\"rendering\""
      ]
    },
    {
      "file": "config/project/folder_balance_budgets.json",
      "must_contain": [
        "\"schema_version\"",
        "\"gate_mode\"",
        "\"scope\"",
        "\"profiles\"",
        "\"tracked_leaf_folders\"",
        "\"score_epsilon\"",
        "\"status_order\""
      ]
    },
    {
      "file": "config/project/policy/manifests/tech_debt_budgets.json",
      "must_contain": [
        "\"schema_version\"",
        "\"gate_mode\"",
        "\"score_epsilon\"",
        "\"baseline\"",
        "\"scoring\"",
        "\"component_weights\"",
        "\"priority_weights\"",
        "\"delivery_size_pressure\"",
        "\"delivery_size\""
      ]
    },
    {
      "file": "config/project/backlog_debt.json",
      "must_contain": [
        "\"schema_version\"",
        "\"active_debt_items\"",
        "\"operational_watch_items\""
      ]
    },
    {
      "file": "scripts/check_architecture_metric_budgets.sh",
      "must_contain": [
        "evaluate_architecture_metric_budget_overages",
        "evaluate_folder_balance_gate",
        "evaluate_tech_debt_gate",
        "config/project/policy/manifests/tech_debt_budgets.json"
      ]
    },
    {
      "file": "config/project/policy/manifests/secret_scan.json",
      "must_contain": [
        "\"patterns\"",
        "\"exclude_dirs\""
      ]
    },
    {
      "file": "config/schema/menu_settings.schema.json",
      "must_contain": [
        "\"$schema\"",
        "\"title\": \"tet4d menu settings\"",
        "\"settings\""
      ]
    },
    {
      "file": "config/schema/save_state.schema.json",
      "must_contain": [
        "\"$schema\"",
        "\"title\": \"tet4d saved game state\"",
        "\"active_piece\""
      ]
    },
    {
      "file": "config/schema/help_topics.schema.json",
      "must_contain": [
        "\"$schema\"",
        "\"title\": \"tet4d help topics registry\"",
        "\"topics\""
      ]
    },
    {
      "file": "config/schema/help_action_map.schema.json",
      "must_contain": [
        "\"$schema\"",
        "\"title\": \"tet4d help action topic map\"",
        "\"action_topics\""
      ]
    },
    {
      "file": "config/help/topics.json",
      "must_contain": [
        "\"version\"",
        "\"topics\"",
        "\"id\"",
        "\"lane\"",
        "\"sections\""
      ]
    },
    {
      "file": "config/help/action_map.json",
      "must_contain": [
        "\"version\"",
        "\"default_topic\"",
        "\"action_topics\"",
        "\"move_x_neg\""
      ]
    },
    {
      "file": "config/help/icon_map.json",
      "must_contain": [
        "\"version\"",
        "\"pack_root\"",
        "\"action_map\"",
        "\"rotate_xy_pos\"",
        "\"rot_xy_pos\""
      ]
    },
    {
      "file": "docs/migrations/menu_settings.md",
      "must_contain": [
        "## Version 1",
        "## Migration policy"
      ]
    },
    {
      "file": "docs/migrations/save_state.md",
      "must_contain": [
        "## Version 1 (planned)",
        "## Migration policy"
      ]
    },
    {
      "file": "config/project/policy/manifests/replay_manifest.json",
      "must_contain": [
        "\"version\": 1",
        "\"gameplay_replay_core\""
      ]
    },
    {
      "file": "docs/help/HELP_INDEX.md",
      "must_contain": [
        "## Control diagrams",
        "## Maintenance rule"
      ]
    },
    {
      "file": "config/help/content/runtime_help_content.json",
      "must_contain": [
        "\"version\": 1",
        "\"topic_blocks\"",
        "\"fallback_topic\""
      ]
    },
    {
      "file": "config/help/layout/runtime_help_layout.json",
      "must_contain": [
        "\"version\": 1",
        "\"topic_media_placement\"",
        "\"controls_topic_id\""
      ]
    },
    {
      "file": "config/schema/help_runtime_content.schema.json",
      "must_contain": [
        "\"$schema\"",
        "\"title\": \"tet4d runtime help content\"",
        "\"topic_blocks\""
      ]
    },
    {
      "file": "config/schema/help_runtime_layout.schema.json",
      "must_contain": [
        "\"$schema\"",
        "\"title\": \"tet4d runtime help layout rules\"",
        "\"topic_media_placement\""
      ]
    },
    {
      "file": "config/project/policy/manifests/help_assets_manifest.json",
      "must_contain": [
        "\"translation_keys\"",
        "\"rotation_keys\""
      ]
    },
    {
      "file": "docs/RELEASE_CHECKLIST.md",
      "must_contain": [
        "## Code and tests",
        "## Documentation and RDS sync",
        "## Artifacts and config"
      ]
    },
    {
      "file": "scripts/check_policy_compliance_repo.sh",
      "must_contain": [
        "AGENTS.md",
        "config/project/policy/manifests/project_policy.json",
        "python3 tools/governance/validate_project_contracts.py",
        "python3 tools/governance/scan_secrets.py",
        "scripts/check_engine_core_purity.sh",
        "scripts/check_architecture_boundaries.sh",
        "legacy 'tetris_nd' imports detected"
      ]
    },
    {
      "file": "scripts/check_git_sanitation_repo.sh",
      "must_contain": [
        "#!/usr/bin/env bash",
        "Absolute filesystem paths detected.",
        "Potential unsafe path traversal patterns detected in docs/ or config/.",
        "Filenames with spaces detected:"
      ]
    },
    {
      "file": "config/project/policy/manifests/replay_manifest.json",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "config/project/policy/manifests/help_assets_manifest.json",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/help/HELP_INDEX.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/FEATURE_MAP.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/RDS_AND_CODEX.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/SECURITY_AND_CONFIG_PLAN.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/rds/RDS_TETRIS_GENERAL.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/rds/RDS_2D_TETRIS.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/rds/RDS_3D_TETRIS.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/rds/RDS_4D_TETRIS.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/rds/RDS_KEYBINDINGS.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/rds/RDS_MENU_STRUCTURE.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    },
    {
      "file": "docs/rds/RDS_PLAYBOT.md",
      "must_not_match_regex": [
        "\\btetris_nd\\b"
      ]
    }
  ],
  "canonical_candidates": [
    {
      "name": "Settings schema and migration ledger",
      "paths": [
        "config/schema/menu_settings.schema.json",
        "docs/migrations/menu_settings.md"
      ],
      "status": "connected"
    },
    {
      "name": "Saved-game/state schema",
      "paths": [
        "config/schema/save_state.schema.json",
        "docs/migrations/save_state.md"
      ],
      "status": "connected"
    },
    {
      "name": "Replay golden fixtures manifest",
      "paths": [
        "config/project/policy/manifests/replay_manifest.json",
        "tests/replay/golden/.gitkeep"
      ],
      "status": "connected"
    },
    {
      "name": "Help content index",
      "paths": [
        "docs/help/HELP_INDEX.md",
        "config/help/content/runtime_help_content.json",
        "config/help/layout/runtime_help_layout.json",
        "config/project/policy/manifests/help_assets_manifest.json"
      ],
      "status": "connected"
    },
    {
      "name": "Help topic contract and schemas",
      "paths": [
        "config/help/topics.json",
        "config/help/action_map.json",
        "config/schema/help_topics.schema.json",
        "config/schema/help_action_map.schema.json"
      ],
      "status": "connected"
    },
    {
      "name": "Runtime help content/layout contracts",
      "paths": [
        "config/help/content/runtime_help_content.json",
        "config/help/layout/runtime_help_layout.json",
        "config/schema/help_runtime_content.schema.json",
        "config/schema/help_runtime_layout.schema.json"
      ],
      "status": "connected"
    },
    {
      "name": "Release checklist",
      "paths": [
        "docs/RELEASE_CHECKLIST.md"
      ],
      "status": "connected"
    },
    {
      "name": "Security and config policy",
      "paths": [
        "docs/SECURITY_AND_CONFIG_PLAN.md",
        "config/project/io_paths.json",
        "config/project/constants.json",
        "config/project/policy/manifests/secret_scan.json",
        "tools/governance/scan_secrets.py"
      ],
      "status": "connected"
    },
    {
      "name": "Architecture debt budget gates",
      "paths": [
        "scripts/arch_metrics.py",
        "scripts/check_architecture_metric_budgets.sh",
        "config/project/folder_balance_budgets.json",
        "config/project/policy/manifests/tech_debt_budgets.json",
        "tools/governance/folder_balance_budget.py",
        "tools/governance/tech_debt_budget.py"
      ],
      "status": "connected"
    }
  ]
}
